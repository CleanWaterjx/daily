## 2021-07-07
1. JavaScript深入之词法作用域和动态作用域

### JavaScript深入之执行上下文栈 
参考资料：[JavaScript深入之执行上下文栈 ](https://github.com/mqyqingfeng/Blog/issues/4)

#### 可执行代码
这就要说到 JavaScript 的可执行代码(executable code)的类型有哪些了？

全局代码、函数代码、eval代码。

遇到函数执行的时候，就会创建一个执行上下文。

举个例子，当执行到一个函数的时候，就会进行准备工作，这里的“准备工作”，让我们用个更专业一点的说法，就叫做"执行上下文(execution context)"。

```
// 函数表达式
var foo = function () {

    console.log('foo1');

}

foo();  // foo1
```
```
// 函数声明
var foo = function () {

    console.log('foo2');

}

foo(); // foo2
```
函数提升，只有函数声明才会提升，函数表达式是不会进行函数提升的。

### js作用域

参考资料：[JS 作用域](https://github.com/nightn/front-end-plan/blob/master/js/js-scope.md)

`执行环境` 定义了 JS 代码的运行环境，这个执行环境包括了 JS 代码有权访问的变量、对象、函数和 this。那具体是怎么实现的呢？其实，执行环境包含了一个叫做 `变量对象` 的东西，这个对象保存了环境中定义的所有变量和函数。执行环境可以分为三类：

- `全局执行环境` ：这是第一行 JS 代码执行时默认的环境，所有的全局代码都在这个环境中执行。
- `函数执行环境` ： 每个函数都有自己的函数执行环境。每当 JS 引擎发现一个**函数调用** （注意是调用，而不是声明），它就会创建一个新的函数执行环境。
- `Eval` : 在 eval 函数中的执行环境。

前面说过，每个执行环境都有一个变量对象，函数执行环境包含的变量对象称之为 `活动对象` 。

`JS引擎` 在分析 JS 代码时分为两个过程，一个是编译阶段，另一个是执行阶段。**编译阶段**主要是处理代码中的变量和函数声明，**执行阶段**才开始执行具体语句。当 JS 代码加载完成后，JS 引擎首先进行代码的编译阶段，它会在这个编译阶段**创建执行环境**，JS 引擎通过 3 个步骤完成执行环境的创建：

- **创建活动对象或者变量对象**：活动对象是 JS 中的一个特殊对象，它包含了当前执行环境所有的变量、函数参数和内部函数声明。活动对象和普通对象不同，它没有 proto 原型属性。
- **创建作用域链**：活动对象创建完毕后，JS 引擎会初始化作用域链，**作用域链其实就是一个存放了很多变量对象的列表**，包括了从全局执行环境的变量对象到当前函数执行环境的变量对象的所有变量对象。JS 引擎就是通过这个作用域链进行变量查找的。
- **确定 this 的值**：初始化作用域链后，JS 引擎开始确定 this 的值。关于 this 的确定，我会用专门的一节进行阐述。

JS 引擎在编译阶段结束后，会进入执行阶段。在执行阶段，JS 引擎会再次对代码进行扫描，对变量对象进行更新，并执行代码。